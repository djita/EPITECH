/*
** exec_redir.c for redir in /home/bonmar_v//Projets/SVN/42sh
** 
** Made by vincent bonmarchand
** Login   <bonmar_v@epitech.net>
** 
** Started on  Sun May 20 14:37:51 2012 vincent bonmarchand
<<<<<<< .mine
** Last update Sun May 20 19:00:46 2012 lyoma guillou
=======
** Last update Sun May 20 17:41:09 2012 vincent bonmarchand
>>>>>>> .r1042
*/

#include <sys/types.h>
#include <sys/stat.h>
#include <fcntl.h>
#include <stdlib.h>
#include <stdio.h>

#include "lltree.h"
#include "execute.h"

#define GETRD(x) strlen(x) == 1 ? O_TRUNC : O_APPEND

static int	_is_char(char c)
{
  return ((c > ' ' && c <= '~'));
}

static char	*_format_str(char *str)
{
  int		i;

  i = 0;
  while (_is_char(str[i]))
    ++i;
  str[i] = '\0';
  return (str);
}

int	exec_redir(t_cmd *node, int fd[2], int *stop)
{
  printf("[Redirection] -- [%s] %s [%s] \n", node->left->name,
	 node->name, node->right->name);
<<<<<<< .mine
  node->left->name = _format_str(node->left->name);
  if (node->name[0] == '>')
    {
      t_fd[0] = fd[0];
      t_fd[1] = open(node->left->name, O_CREAT | GETRD(node->left->name));
      if (node->right != NULL)
	exec_node(node->right, t_fd, stop);
    }
  else
    {
      t_fd[0] = open(node->left->name, O_RDONLY);
      t_fd[1] = fd[1];
      if (node->right != NULL)
	exec_node(node->right, t_fd, stop);
    }
=======
  if (node->left != NULL)
    exec_node(node->left, fd, stop);
  if (node->right != NULL)
    exec_node(node->right, fd, stop);
>>>>>>> .r1042
  return (EXIT_SUCCESS);
}
