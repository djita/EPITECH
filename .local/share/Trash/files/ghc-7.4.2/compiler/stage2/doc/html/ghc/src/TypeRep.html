<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>types/TypeRep.lhs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
 | %
% (c) The University of Glasgow 2006
% (c) The GRASP/AQUA Project, Glasgow University, 1998
%
\section[TypeRep]{Type - friends' interface}

\begin{code}
<pre><a name="line-1"></a><span class='hs-comment'>{-# OPTIONS -fno-warn-tabs #-}</span>
<a name="line-2"></a><span class='hs-comment'>-- The above warning supression flag is a temporary kludge.</span>
<a name="line-3"></a><span class='hs-comment'>-- While working on this module you are encouraged to remove it and</span>
<a name="line-4"></a><span class='hs-comment'>-- detab the module (please do the detabbing in a separate patch). See</span>
<a name="line-5"></a><span class='hs-comment'>--     <a href="http://hackage.haskell.org/trac/ghc/wiki/Commentary/CodingStyle#TabsvsSpaces">http://hackage.haskell.org/trac/ghc/wiki/Commentary/CodingStyle#TabsvsSpaces</a></span>
<a name="line-6"></a><span class='hs-comment'>-- for details</span>
<a name="line-7"></a>
<a name="line-8"></a><span class='hs-comment'>-- We expose the relevant stuff from this module via the Type module</span>
<a name="line-9"></a><span class='hs-comment'>{-# OPTIONS_HADDOCK hide #-}</span>
<a name="line-10"></a><span class='hs-comment'>{-# LANGUAGE DeriveDataTypeable, DeriveFunctor, DeriveFoldable, DeriveTraversable #-}</span>
<a name="line-11"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>TypeRep</span> <span class='hs-layout'>(</span>
<a name="line-12"></a>	<span class='hs-conid'>TyThing</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-13"></a>	<span class='hs-conid'>Type</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-14"></a>        <span class='hs-conid'>KindOrType</span><span class='hs-layout'>,</span> <span class='hs-conid'>Kind</span><span class='hs-layout'>,</span> <span class='hs-conid'>SuperKind</span><span class='hs-layout'>,</span>
<a name="line-15"></a>        <span class='hs-conid'>PredType</span><span class='hs-layout'>,</span> <span class='hs-conid'>ThetaType</span><span class='hs-layout'>,</span>      <span class='hs-comment'>-- Synonyms</span>
<a name="line-16"></a>
<a name="line-17"></a>        <span class='hs-comment'>-- Functions over types</span>
<a name="line-18"></a>        <span class='hs-varid'>mkTyConApp</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTyConTy</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTyVarTy</span><span class='hs-layout'>,</span> <span class='hs-varid'>mkTyVarTys</span><span class='hs-layout'>,</span>
<a name="line-19"></a>        <span class='hs-varid'>isLiftedTypeKind</span><span class='hs-layout'>,</span>
<a name="line-20"></a>        
<a name="line-21"></a>        <span class='hs-comment'>-- Pretty-printing</span>
<a name="line-22"></a>	<span class='hs-varid'>pprType</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendType</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprTypeApp</span><span class='hs-layout'>,</span>
<a name="line-23"></a>	<span class='hs-varid'>pprTyThing</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprTyThingCategory</span><span class='hs-layout'>,</span> 
<a name="line-24"></a>	<span class='hs-varid'>pprEqPred</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprTheta</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprForAll</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprThetaArrowTy</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprClassPred</span><span class='hs-layout'>,</span>
<a name="line-25"></a>        <span class='hs-varid'>pprKind</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendKind</span><span class='hs-layout'>,</span>
<a name="line-26"></a>	<span class='hs-conid'>Prec</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>maybeParen</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprTcApp</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprTypeNameApp</span><span class='hs-layout'>,</span> 
<a name="line-27"></a>        <span class='hs-varid'>pprPrefixApp</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprArrowChain</span><span class='hs-layout'>,</span> <span class='hs-varid'>ppr_type</span><span class='hs-layout'>,</span>
<a name="line-28"></a>
<a name="line-29"></a>        <span class='hs-comment'>-- Free variables</span>
<a name="line-30"></a>        <span class='hs-varid'>tyVarsOfType</span><span class='hs-layout'>,</span> <span class='hs-varid'>tyVarsOfTypes</span><span class='hs-layout'>,</span>
<a name="line-31"></a>
<a name="line-32"></a>        <span class='hs-comment'>-- Substitutions</span>
<a name="line-33"></a>        <span class='hs-conid'>TvSubst</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>TvSubstEnv</span>
<a name="line-34"></a>    <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-35"></a>
<a name="line-36"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-37"></a>
<a name="line-38"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>DataCon</span><span class='hs-layout'>(</span> <span class='hs-conid'>DataCon</span><span class='hs-layout'>,</span> <span class='hs-varid'>dataConName</span> <span class='hs-layout'>)</span>
<a name="line-39"></a><span class='hs-keyword'>import</span> <span class='hs-comment'>{-# SOURCE #-}</span> <span class='hs-conid'>Type</span><span class='hs-layout'>(</span> <span class='hs-varid'>noParenPred</span><span class='hs-layout'>,</span> <span class='hs-varid'>isPredTy</span> <span class='hs-layout'>)</span> <span class='hs-comment'>-- Transitively pulls in a LOT of stuff, better to break the loop</span>
<a name="line-40"></a>
<a name="line-41"></a><span class='hs-comment'>-- friends:</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Var</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>VarEnv</span>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>VarSet</span>
<a name="line-45"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Name</span>
<a name="line-46"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BasicTypes</span>
<a name="line-47"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>TyCon</span>
<a name="line-48"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Class</span>
<a name="line-49"></a>
<a name="line-50"></a><span class='hs-comment'>-- others</span>
<a name="line-51"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>PrelNames</span>
<a name="line-52"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Outputable</span>
<a name="line-53"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-54"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Pair</span>
<a name="line-55"></a>
<a name="line-56"></a><span class='hs-comment'>-- libraries</span>
<a name="line-57"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span>        <span class='hs-keyword'>as</span> <span class='hs-conid'>Data</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span> <span class='hs-conid'>TyCon</span> <span class='hs-layout'>)</span>
</pre>\end{code}


%************************************************************************
%*									*
\subsection{The data type}
%*									*
%************************************************************************


\begin{code}
<pre><a name="line-1"></a><a name="Type"></a><span class='hs-comment'>-- | The key representation of types within the compiler</span>
<a name="line-2"></a><a name="Type"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Type</span>
<a name="line-3"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyVarTy</span> <span class='hs-conid'>Var</span>	<span class='hs-comment'>-- ^ Vanilla type or kind variable (*never* a coercion variable)</span>
<a name="line-4"></a>
<a name="line-5"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>AppTy</span>         <span class='hs-comment'>-- See Note [AppTy invariant]</span>
<a name="line-6"></a>	<span class='hs-conid'>Type</span>
<a name="line-7"></a>	<span class='hs-conid'>Type</span>		<span class='hs-comment'>-- ^ Type application to something other than a 'TyCon'. Parameters:</span>
<a name="line-8"></a>	                <span class='hs-comment'>--</span>
<a name="line-9"></a>                        <span class='hs-comment'>--  1) Function: must /not/ be a 'TyConApp',</span>
<a name="line-10"></a>                        <span class='hs-comment'>--     must be another 'AppTy', or 'TyVarTy'</span>
<a name="line-11"></a>	                <span class='hs-comment'>--</span>
<a name="line-12"></a>	                <span class='hs-comment'>--  2) Argument type</span>
<a name="line-13"></a>
<a name="line-14"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TyConApp</span>      <span class='hs-comment'>-- See Note [AppTy invariant]</span>
<a name="line-15"></a>	<span class='hs-conid'>TyCon</span>
<a name="line-16"></a>	<span class='hs-keyglyph'>[</span><span class='hs-conid'>KindOrType</span><span class='hs-keyglyph'>]</span>	<span class='hs-comment'>-- ^ Application of a 'TyCon', including newtypes /and/ synonyms.</span>
<a name="line-17"></a>	                <span class='hs-comment'>-- Invariant: saturated appliations of 'FunTyCon' must</span>
<a name="line-18"></a>	                <span class='hs-comment'>-- use 'FunTy' and saturated synonyms must use their own</span>
<a name="line-19"></a>                        <span class='hs-comment'>-- constructors. However, /unsaturated/ 'FunTyCon's</span>
<a name="line-20"></a>                        <span class='hs-comment'>-- do appear as 'TyConApp's.</span>
<a name="line-21"></a>	                <span class='hs-comment'>-- Parameters:</span>
<a name="line-22"></a>	                <span class='hs-comment'>--</span>
<a name="line-23"></a>	                <span class='hs-comment'>-- 1) Type constructor being applied to.</span>
<a name="line-24"></a>	                <span class='hs-comment'>--</span>
<a name="line-25"></a>                        <span class='hs-comment'>-- 2) Type arguments. Might not have enough type arguments</span>
<a name="line-26"></a>                        <span class='hs-comment'>--    here to saturate the constructor.</span>
<a name="line-27"></a>                        <span class='hs-comment'>--    Even type synonyms are not necessarily saturated;</span>
<a name="line-28"></a>                        <span class='hs-comment'>--    for example unsaturated type synonyms</span>
<a name="line-29"></a>	                <span class='hs-comment'>--    can appear as the right hand side of a type synonym.</span>
<a name="line-30"></a>
<a name="line-31"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FunTy</span>
<a name="line-32"></a>	<span class='hs-conid'>Type</span>		
<a name="line-33"></a>	<span class='hs-conid'>Type</span>		<span class='hs-comment'>-- ^ Special case of 'TyConApp': @TyConApp FunTyCon [t1, t2]@</span>
<a name="line-34"></a>			<span class='hs-comment'>-- See Note [Equality-constrained types]</span>
<a name="line-35"></a>
<a name="line-36"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ForAllTy</span>
<a name="line-37"></a>	<span class='hs-conid'>Var</span>         <span class='hs-comment'>-- Type or kind variable</span>
<a name="line-38"></a>	<span class='hs-conid'>Type</span>	        <span class='hs-comment'>-- ^ A polymorphic type</span>
<a name="line-39"></a>
<a name="line-40"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Data</span><span class='hs-layout'>,</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Typeable</span><span class='hs-layout'>)</span>
<a name="line-41"></a>
<a name="line-42"></a><a name="KindOrType"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>KindOrType</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Type</span> <span class='hs-comment'>-- See Note [Arguments to type constructors]</span>
<a name="line-43"></a>
<a name="line-44"></a><a name="Kind"></a><span class='hs-comment'>-- | The key type representing kinds in the compiler.</span>
<a name="line-45"></a><a name="Kind"></a><span class='hs-comment'>-- Invariant: a kind is always in one of these forms:</span>
<a name="line-46"></a><a name="Kind"></a><span class='hs-comment'>--</span>
<a name="line-47"></a><a name="Kind"></a><span class='hs-comment'>-- &gt; FunTy k1 k2</span>
<a name="line-48"></a><a name="Kind"></a><span class='hs-comment'>-- &gt; TyConApp PrimTyCon [...]</span>
<a name="line-49"></a><a name="Kind"></a><span class='hs-comment'>-- &gt; TyVar kv   -- (during inference only)</span>
<a name="line-50"></a><a name="Kind"></a><span class='hs-comment'>-- &gt; ForAll ... -- (for top-level coercions)</span>
<a name="line-51"></a><a name="Kind"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Type</span>
<a name="line-52"></a>
<a name="line-53"></a><a name="SuperKind"></a><span class='hs-comment'>-- | "Super kinds", used to help encode 'Kind's as types.</span>
<a name="line-54"></a><a name="SuperKind"></a><span class='hs-comment'>-- Invariant: a super kind is always of this form:</span>
<a name="line-55"></a><a name="SuperKind"></a><span class='hs-comment'>--</span>
<a name="line-56"></a><a name="SuperKind"></a><span class='hs-comment'>-- &gt; TyConApp SuperKindTyCon ...</span>
<a name="line-57"></a><a name="SuperKind"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>SuperKind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Type</span>
</pre>\end{code}

Note [The kind invariant]
~~~~~~~~~~~~~~~~~~~~~~~~~
The kinds
   #          UnliftedTypeKind
   ArgKind    super-kind of *, #
   (#)        UbxTupleKind
   OpenKind   super-kind of ArgKind, ubxTupleKind

can never appear under an arrow or type constructor in a kind; they
can only be at the top level of a kind.  It follows that primitive TyCons,
which have a naughty pseudo-kind
   State# :: * -> #
must always be saturated, so that we can never get a type whose kind
has a UnliftedTypeKind or ArgTypeKind underneath an arrow.

Nor can we abstract over a type variable with any of these kinds.

    k :: = kk | # | ArgKind | (#) | OpenKind 
    kk :: = * | kk -> kk | T kk1 ... kkn

So a type variable can only be abstracted kk.

Note [Arguments to type constructors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Because of kind polymorphism, in addition to type application we now
have kind instantiation. We reuse the same notations to do so.

For example:

  Just (* -> *) Maybe
  Right * Nat Zero

are represented by:

  TyConApp (PromotedDataCon Just) [* -> *, Maybe]
  TyConApp (PromotedDataCon Right) [*, Nat, (PromotedDataCon Zero)]

Important note: Nat is used as a *kind* and not as a type. This can be
confusing, since type-level Nat and kind-level Nat are identical. We
use the kind of (PromotedDataCon Right) to know if its arguments are
kinds or types.

This kind instantiation only happens in TyConApp currently.


Note [Equality-constrained types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The type   forall ab. (a ~ [b]) => blah
is encoded like this:

   ForAllTy (a:*) $ ForAllTy (b:*) $
   FunTy (TyConApp (~) [a, [b]]) $
   blah

-------------------------------------
 		Note [PredTy]

\begin{code}
<pre><a name="line-1"></a><a name="PredType"></a><span class='hs-comment'>-- | A type of the form @p@ of kind @Constraint@ represents a value whose type is</span>
<a name="line-2"></a><a name="PredType"></a><span class='hs-comment'>-- the Haskell predicate @p@, where a predicate is what occurs before </span>
<a name="line-3"></a><a name="PredType"></a><span class='hs-comment'>-- the @=&gt;@ in a Haskell type.</span>
<a name="line-4"></a><a name="PredType"></a><span class='hs-comment'>--</span>
<a name="line-5"></a><a name="PredType"></a><span class='hs-comment'>-- We use 'PredType' as documentation to mark those types that we guarantee to have</span>
<a name="line-6"></a><a name="PredType"></a><span class='hs-comment'>-- this kind.</span>
<a name="line-7"></a><a name="PredType"></a><span class='hs-comment'>--</span>
<a name="line-8"></a><a name="PredType"></a><span class='hs-comment'>-- It can be expanded into its representation, but: </span>
<a name="line-9"></a><a name="PredType"></a><span class='hs-comment'>--</span>
<a name="line-10"></a><a name="PredType"></a><span class='hs-comment'>-- * The type checker must treat it as opaque</span>
<a name="line-11"></a><a name="PredType"></a><span class='hs-comment'>--</span>
<a name="line-12"></a><a name="PredType"></a><span class='hs-comment'>-- * The rest of the compiler treats it as transparent</span>
<a name="line-13"></a><a name="PredType"></a><span class='hs-comment'>--</span>
<a name="line-14"></a><a name="PredType"></a><span class='hs-comment'>-- Consider these examples:</span>
<a name="line-15"></a><a name="PredType"></a><span class='hs-comment'>--</span>
<a name="line-16"></a><a name="PredType"></a><span class='hs-comment'>-- &gt; f :: (Eq a) =&gt; a -&gt; Int</span>
<a name="line-17"></a><a name="PredType"></a><span class='hs-comment'>-- &gt; g :: (?x :: Int -&gt; Int) =&gt; a -&gt; Int</span>
<a name="line-18"></a><a name="PredType"></a><span class='hs-comment'>-- &gt; h :: (r\l) =&gt; {r} =&gt; {l::Int | r}</span>
<a name="line-19"></a><a name="PredType"></a><span class='hs-comment'>--</span>
<a name="line-20"></a><a name="PredType"></a><span class='hs-comment'>-- Here the @Eq a@ and @?x :: Int -&gt; Int@ and @r\l@ are all called \"predicates\"</span>
<a name="line-21"></a><a name="PredType"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>PredType</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Type</span>
<a name="line-22"></a>
<a name="line-23"></a><a name="ThetaType"></a><span class='hs-comment'>-- | A collection of 'PredType's</span>
<a name="line-24"></a><a name="ThetaType"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>ThetaType</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>PredType</span><span class='hs-keyglyph'>]</span>
</pre>\end{code}

(We don't support TREX records yet, but the setup is designed
to expand to allow them.)

A Haskell qualified type, such as that for f,g,h above, is
represented using 
	* a FunTy for the double arrow
	* with a type of kind Constraint as the function argument

The predicate really does turn into a real extra argument to the
function.  If the argument has type (p :: Constraint) then the predicate p is
represented by evidence of type p.

%************************************************************************
%*									*
            Simple constructors
%*									*
%************************************************************************

These functions are here so that they can be used by TysPrim,
which in turn is imported by Type

\begin{code}
<pre><a name="line-1"></a><a name="mkTyVarTy"></a><span class='hs-definition'>mkTyVarTy</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyVar</span>   <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span>
<a name="line-2"></a><span class='hs-definition'>mkTyVarTy</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyVarTy</span>
<a name="line-3"></a>
<a name="line-4"></a><a name="mkTyVarTys"></a><span class='hs-definition'>mkTyVarTys</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span>
<a name="line-5"></a><span class='hs-definition'>mkTyVarTys</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>mkTyVarTy</span> <span class='hs-comment'>-- a common use of mkTyVarTy</span>
<a name="line-6"></a>
<a name="line-7"></a><a name="mkTyConApp"></a><span class='hs-comment'>-- | A key function: builds a 'TyConApp' or 'FunTy' as apppropriate to its arguments.</span>
<a name="line-8"></a><span class='hs-comment'>-- Applies its arguments to the constructor from left to right</span>
<a name="line-9"></a><span class='hs-definition'>mkTyConApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span>
<a name="line-10"></a><span class='hs-definition'>mkTyConApp</span> <span class='hs-varid'>tycon</span> <span class='hs-varid'>tys</span>
<a name="line-11"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isFunTyCon</span> <span class='hs-varid'>tycon</span><span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ty1</span><span class='hs-layout'>,</span><span class='hs-varid'>ty2</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tys</span>
<a name="line-12"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>FunTy</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span>
<a name="line-13"></a>
<a name="line-14"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-15"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyConApp</span> <span class='hs-varid'>tycon</span> <span class='hs-varid'>tys</span>
<a name="line-16"></a>
<a name="line-17"></a><a name="mkTyConTy"></a><span class='hs-comment'>-- | Create the plain type constructor type which has been applied to no type arguments at all.</span>
<a name="line-18"></a><span class='hs-definition'>mkTyConTy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span>
<a name="line-19"></a><span class='hs-definition'>mkTyConTy</span> <span class='hs-varid'>tycon</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mkTyConApp</span> <span class='hs-varid'>tycon</span> <span class='hs-conid'>[]</span>
<a name="line-20"></a>
<a name="line-21"></a><a name="isLiftedTypeKind"></a><span class='hs-definition'>isLiftedTypeKind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<a name="line-22"></a><span class='hs-comment'>-- This function is here because it's used in the pretty printer</span>
<a name="line-23"></a><span class='hs-definition'>isLiftedTypeKind</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyConApp</span> <span class='hs-varid'>tc</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>liftedTypeKindTyConKey</span>
<a name="line-24"></a><span class='hs-definition'>isLiftedTypeKind</span> <span class='hs-keyword'>_</span>                <span class='hs-keyglyph'>=</span> <span class='hs-conid'>False</span>
</pre>\end{code}


%************************************************************************
%*									*
			Free variables of types and coercions
%*									*
%************************************************************************

\begin{code}  
<pre><a name="line-1"></a><a name="tyVarsOfType"></a><span class='hs-definition'>tyVarsOfType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>VarSet</span>
<a name="line-2"></a><span class='hs-comment'>-- ^ NB: for type synonyms tyVarsOfType does /not/ expand the synonym</span>
<a name="line-3"></a><span class='hs-comment'>-- tyVarsOfType returns only the free *type* variables of a type</span>
<a name="line-4"></a><span class='hs-comment'>-- For example, tyVarsOfType (a::k) returns {a}, not including the</span>
<a name="line-5"></a><span class='hs-comment'>-- kind variable {k}</span>
<a name="line-6"></a><span class='hs-definition'>tyVarsOfType</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyVarTy</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unitVarSet</span> <span class='hs-varid'>v</span>
<a name="line-7"></a><span class='hs-definition'>tyVarsOfType</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyConApp</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyVarsOfTypes</span> <span class='hs-varid'>tys</span>
<a name="line-8"></a><span class='hs-definition'>tyVarsOfType</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunTy</span> <span class='hs-varid'>arg</span> <span class='hs-varid'>res</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyVarsOfType</span> <span class='hs-varid'>arg</span> <span class='hs-varop'>`unionVarSet`</span> <span class='hs-varid'>tyVarsOfType</span> <span class='hs-varid'>res</span>
<a name="line-9"></a><span class='hs-definition'>tyVarsOfType</span> <span class='hs-layout'>(</span><span class='hs-conid'>AppTy</span> <span class='hs-varid'>fun</span> <span class='hs-varid'>arg</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyVarsOfType</span> <span class='hs-varid'>fun</span> <span class='hs-varop'>`unionVarSet`</span> <span class='hs-varid'>tyVarsOfType</span> <span class='hs-varid'>arg</span>
<a name="line-10"></a><span class='hs-definition'>tyVarsOfType</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForAllTy</span> <span class='hs-varid'>tyvar</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>delVarSet</span> <span class='hs-layout'>(</span><span class='hs-varid'>tyVarsOfType</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> <span class='hs-varid'>tyvar</span>
<a name="line-11"></a>
<a name="line-12"></a><a name="tyVarsOfTypes"></a><span class='hs-definition'>tyVarsOfTypes</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyVarSet</span>
<a name="line-13"></a><span class='hs-definition'>tyVarsOfTypes</span> <span class='hs-varid'>tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldr</span> <span class='hs-layout'>(</span><span class='hs-varid'>unionVarSet</span> <span class='hs-varop'>.</span> <span class='hs-varid'>tyVarsOfType</span><span class='hs-layout'>)</span> <span class='hs-varid'>emptyVarSet</span> <span class='hs-varid'>tys</span>
</pre>\end{code}

%************************************************************************
%*									*
			TyThing
%*									*
%************************************************************************

Despite the fact that DataCon has to be imported via a hi-boot route, 
this module seems the right place for TyThing, because it's needed for
funTyCon and all the types in TysPrim.

Note [ATyCon for classes]
~~~~~~~~~~~~~~~~~~~~~~~~~
Both classes and type constructors are represented in the type environment
as ATyCon.  You can tell the difference, and get to the class, with
   isClassTyCon :: TyCon -> Bool
   tyConClass_maybe :: TyCon -> Maybe Class
The Class and its associated TyCon have the same Name.

\begin{code}
<pre><a name="line-1"></a><a name="TyThing"></a><span class='hs-comment'>-- | A typecheckable-thing, essentially anything that has a name</span>
<a name="line-2"></a><a name="TyThing"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TyThing</span> 
<a name="line-3"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>AnId</span>     <span class='hs-conid'>Id</span>
<a name="line-4"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ADataCon</span> <span class='hs-conid'>DataCon</span>
<a name="line-5"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ATyCon</span>   <span class='hs-conid'>TyCon</span>       <span class='hs-comment'>-- TyCons and classes; see Note [ATyCon for classes]</span>
<a name="line-6"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ACoAxiom</span> <span class='hs-conid'>CoAxiom</span>
<a name="line-7"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span><span class='hs-layout'>)</span>
<a name="line-8"></a>
<a name="line-9"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>TyThing</span> <span class='hs-keyword'>where</span> 
<a name="line-10"></a>  <span class='hs-varid'>ppr</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTyThing</span>
<a name="line-11"></a>
<a name="line-12"></a><a name="pprTyThing"></a><span class='hs-definition'>pprTyThing</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyThing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-13"></a><span class='hs-definition'>pprTyThing</span> <span class='hs-varid'>thing</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTyThingCategory</span> <span class='hs-varid'>thing</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>quotes</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-layout'>(</span><span class='hs-varid'>getName</span> <span class='hs-varid'>thing</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-14"></a>
<a name="line-15"></a><a name="pprTyThingCategory"></a><span class='hs-definition'>pprTyThingCategory</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyThing</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-16"></a><span class='hs-definition'>pprTyThingCategory</span> <span class='hs-layout'>(</span><span class='hs-conid'>ATyCon</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span>
<a name="line-17"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isClassTyCon</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Class"</span><span class='hs-layout'>)</span>
<a name="line-18"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Type constructor"</span><span class='hs-layout'>)</span>
<a name="line-19"></a><span class='hs-definition'>pprTyThingCategory</span> <span class='hs-layout'>(</span><span class='hs-conid'>ACoAxiom</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Coercion axiom"</span><span class='hs-layout'>)</span>
<a name="line-20"></a><span class='hs-definition'>pprTyThingCategory</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnId</span>   <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Identifier"</span><span class='hs-layout'>)</span>
<a name="line-21"></a><span class='hs-definition'>pprTyThingCategory</span> <span class='hs-layout'>(</span><span class='hs-conid'>ADataCon</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"Data constructor"</span><span class='hs-layout'>)</span>
<a name="line-22"></a>
<a name="line-23"></a>
<a name="line-24"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>NamedThing</span> <span class='hs-conid'>TyThing</span> <span class='hs-keyword'>where</span>	<span class='hs-comment'>-- Can't put this with the type</span>
<a name="line-25"></a>  <span class='hs-varid'>getName</span> <span class='hs-layout'>(</span><span class='hs-conid'>AnId</span> <span class='hs-varid'>id</span><span class='hs-layout'>)</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getName</span> <span class='hs-varid'>id</span>	<span class='hs-comment'>-- decl, because the DataCon instance</span>
<a name="line-26"></a>  <span class='hs-varid'>getName</span> <span class='hs-layout'>(</span><span class='hs-conid'>ATyCon</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getName</span> <span class='hs-varid'>tc</span>	<span class='hs-comment'>-- isn't visible there</span>
<a name="line-27"></a>  <span class='hs-varid'>getName</span> <span class='hs-layout'>(</span><span class='hs-conid'>ACoAxiom</span> <span class='hs-varid'>cc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getName</span> <span class='hs-varid'>cc</span>
<a name="line-28"></a>  <span class='hs-varid'>getName</span> <span class='hs-layout'>(</span><span class='hs-conid'>ADataCon</span> <span class='hs-varid'>dc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>dataConName</span> <span class='hs-varid'>dc</span>
<a name="line-29"></a>
</pre>\end{code}


%************************************************************************
%*									*
			Substitutions
      Data type defined here to avoid unnecessary mutual recursion
%*									*
%************************************************************************

\begin{code}
<pre><a name="line-1"></a><a name="TvSubst"></a><span class='hs-comment'>-- | Type substitution</span>
<a name="line-2"></a><a name="TvSubst"></a><span class='hs-comment'>--</span>
<a name="line-3"></a><a name="TvSubst"></a><span class='hs-comment'>-- #tvsubst_invariant#</span>
<a name="line-4"></a><a name="TvSubst"></a><span class='hs-comment'>-- The following invariants must hold of a 'TvSubst':</span>
<a name="line-5"></a><a name="TvSubst"></a><span class='hs-comment'>-- </span>
<a name="line-6"></a><a name="TvSubst"></a><span class='hs-comment'>-- 1. The in-scope set is needed /only/ to</span>
<a name="line-7"></a><a name="TvSubst"></a><span class='hs-comment'>-- guide the generation of fresh uniques</span>
<a name="line-8"></a><a name="TvSubst"></a><span class='hs-comment'>--</span>
<a name="line-9"></a><a name="TvSubst"></a><span class='hs-comment'>-- 2. In particular, the /kind/ of the type variables in </span>
<a name="line-10"></a><a name="TvSubst"></a><span class='hs-comment'>-- the in-scope set is not relevant</span>
<a name="line-11"></a><a name="TvSubst"></a><span class='hs-comment'>--</span>
<a name="line-12"></a><a name="TvSubst"></a><span class='hs-comment'>-- 3. The substition is only applied ONCE! This is because</span>
<a name="line-13"></a><a name="TvSubst"></a><span class='hs-comment'>-- in general such application will not reached a fixed point.</span>
<a name="line-14"></a><a name="TvSubst"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>TvSubst</span> 		
<a name="line-15"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TvSubst</span> <span class='hs-conid'>InScopeSet</span> 	<span class='hs-comment'>-- The in-scope type and kind variables</span>
<a name="line-16"></a>	    <span class='hs-conid'>TvSubstEnv</span>  <span class='hs-comment'>-- Substitutes both type and kind variables</span>
<a name="line-17"></a>	<span class='hs-comment'>-- See Note [Apply Once]</span>
<a name="line-18"></a>	<span class='hs-comment'>-- and Note [Extending the TvSubstEnv]</span>
<a name="line-19"></a>
<a name="line-20"></a><a name="TvSubstEnv"></a><span class='hs-comment'>-- | A substitition of 'Type's for 'TyVar's</span>
<a name="line-21"></a><a name="TvSubstEnv"></a><span class='hs-comment'>--                 and 'Kind's for 'KindVar's</span>
<a name="line-22"></a><a name="TvSubstEnv"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>TvSubstEnv</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TyVarEnv</span> <span class='hs-conid'>Type</span>
<a name="line-23"></a>	<span class='hs-comment'>-- A TvSubstEnv is used both inside a TvSubst (with the apply-once</span>
<a name="line-24"></a>	<span class='hs-comment'>-- invariant discussed in Note [Apply Once]), and also independently</span>
<a name="line-25"></a>	<span class='hs-comment'>-- in the middle of matching, and unification (see Types.Unify)</span>
<a name="line-26"></a>	<span class='hs-comment'>-- So you have to look at the context to know if it's idempotent or</span>
<a name="line-27"></a>	<span class='hs-comment'>-- apply-once or whatever</span>
</pre>\end{code}

Note [Apply Once]
~~~~~~~~~~~~~~~~~
We use TvSubsts to instantiate things, and we might instantiate
	forall a b. ty
\with the types
	[a, b], or [b, a].
So the substition might go [a->b, b->a].  A similar situation arises in Core
when we find a beta redex like
	(/\ a /\ b -> e) b a
Then we also end up with a substition that permutes type variables. Other
variations happen to; for example [a -> (a, b)].  

	***************************************************
	*** So a TvSubst must be applied precisely once ***
	***************************************************

A TvSubst is not idempotent, but, unlike the non-idempotent substitution
we use during unifications, it must not be repeatedly applied.

Note [Extending the TvSubst]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
See #tvsubst_invariant# for the invariants that must hold.

This invariant allows a short-cut when the TvSubstEnv is empty:
if the TvSubstEnv is empty --- i.e. (isEmptyTvSubt subst) holds ---
then (substTy subst ty) does nothing.

For example, consider:
	(/\a. /\b:(a~Int). ...b..) Int
We substitute Int for 'a'.  The Unique of 'b' does not change, but
nevertheless we add 'b' to the TvSubstEnv, because b's kind does change

This invariant has several crucial consequences:

* In substTyVarBndr, we need extend the TvSubstEnv 
	- if the unique has changed
	- or if the kind has changed

* In substTyVar, we do not need to consult the in-scope set;
  the TvSubstEnv is enough

* In substTy, substTheta, we can short-circuit when the TvSubstEnv is empty
\end{code}



%************************************************************************
%*									*
                   Pretty-printing types

       Defined very early because of debug printing in assertions
%*                                                                      *
%************************************************************************

@pprType@ is the standard @Type@ printer; the overloaded @ppr@ function is
defined to use this.  @pprParendType@ is the same, except it puts
parens around the type, except for the atomic cases.  @pprParendType@
works just by setting the initial context precedence very high.

\begin{code}
<pre><a name="line-1"></a><a name="Prec"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>TopPrec</span> 	<span class='hs-comment'>-- No parens</span>
<a name="line-2"></a>	  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>FunPrec</span> 	<span class='hs-comment'>-- Function args; no parens for tycon apps</span>
<a name="line-3"></a>	  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>TyConPrec</span> 	<span class='hs-comment'>-- Tycon args; no parens for atomic</span>
<a name="line-4"></a>	  <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>,</span> <span class='hs-conid'>Ord</span> <span class='hs-layout'>)</span>
<a name="line-5"></a>
<a name="line-6"></a><a name="maybeParen"></a><span class='hs-definition'>maybeParen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-7"></a><span class='hs-definition'>maybeParen</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varid'>inner_prec</span> <span class='hs-varid'>pretty</span>
<a name="line-8"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>ctxt_prec</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>inner_prec</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pretty</span>
<a name="line-9"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>		   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-varid'>pretty</span>
<a name="line-10"></a>
<a name="line-11"></a><a name="pprType"></a><span class='hs-comment'>------------------</span>
<a name="line-12"></a><span class='hs-definition'>pprType</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendType</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-13"></a><span class='hs-definition'>pprType</span>       <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_type</span> <span class='hs-conid'>TopPrec</span> <span class='hs-varid'>ty</span>
<a name="line-14"></a><a name="pprParendType"></a><span class='hs-definition'>pprParendType</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_type</span> <span class='hs-conid'>TyConPrec</span> <span class='hs-varid'>ty</span>
<a name="line-15"></a>
<a name="line-16"></a><a name="pprKind"></a><span class='hs-definition'>pprKind</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprParendKind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Kind</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-17"></a><span class='hs-definition'>pprKind</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprType</span>
<a name="line-18"></a><a name="pprParendKind"></a><span class='hs-definition'>pprParendKind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprParendType</span>
<a name="line-19"></a>
<a name="line-20"></a><a name="pprEqPred"></a><span class='hs-comment'>------------------</span>
<a name="line-21"></a><span class='hs-definition'>pprEqPred</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Pair</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-22"></a><span class='hs-comment'>-- NB: Maybe move to Coercion? It's only called after coercionKind anyway. </span>
<a name="line-23"></a><span class='hs-definition'>pprEqPred</span> <span class='hs-layout'>(</span><span class='hs-conid'>Pair</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span><span class='hs-layout'>)</span> 
<a name="line-24"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>ppr_type</span> <span class='hs-conid'>FunPrec</span> <span class='hs-varid'>ty1</span>
<a name="line-25"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>nest</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"~#"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-26"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>ppr_type</span> <span class='hs-conid'>FunPrec</span> <span class='hs-varid'>ty2</span><span class='hs-keyglyph'>]</span>
<a name="line-27"></a>    <span class='hs-comment'>-- Precedence looks like (-&gt;) so that we get</span>
<a name="line-28"></a>    <span class='hs-comment'>--    Maybe a ~ Bool</span>
<a name="line-29"></a>    <span class='hs-comment'>--    (a-&gt;a) ~ Bool</span>
<a name="line-30"></a>    <span class='hs-comment'>-- Note parens on the latter!</span>
<a name="line-31"></a>
<a name="line-32"></a><a name="pprClassPred"></a><span class='hs-comment'>------------</span>
<a name="line-33"></a><span class='hs-definition'>pprClassPred</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Class</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-34"></a><span class='hs-definition'>pprClassPred</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_class_pred</span> <span class='hs-varid'>ppr_type</span>
<a name="line-35"></a>
<a name="line-36"></a><a name="ppr_class_pred"></a><span class='hs-definition'>ppr_class_pred</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Class</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-37"></a><span class='hs-definition'>ppr_class_pred</span> <span class='hs-varid'>pp</span> <span class='hs-varid'>clas</span> <span class='hs-varid'>tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTypeNameApp</span> <span class='hs-conid'>TopPrec</span> <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-varid'>getName</span> <span class='hs-varid'>clas</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span>
<a name="line-38"></a>
<a name="line-39"></a><a name="pprTheta"></a><span class='hs-comment'>------------</span>
<a name="line-40"></a><span class='hs-definition'>pprTheta</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ThetaType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-41"></a><span class='hs-comment'>-- pprTheta [pred] = pprPred pred	 -- I'm in two minds about this</span>
<a name="line-42"></a><span class='hs-definition'>pprTheta</span> <span class='hs-varid'>theta</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_type</span> <span class='hs-conid'>TopPrec</span><span class='hs-layout'>)</span> <span class='hs-varid'>theta</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-43"></a>
<a name="line-44"></a><a name="pprThetaArrowTy"></a><span class='hs-definition'>pprThetaArrowTy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ThetaType</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-45"></a><span class='hs-definition'>pprThetaArrowTy</span> <span class='hs-conid'>[]</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-46"></a><span class='hs-definition'>pprThetaArrowTy</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pred</span><span class='hs-keyglyph'>]</span>
<a name="line-47"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>noParenPred</span> <span class='hs-varid'>pred</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_type</span> <span class='hs-conid'>TopPrec</span> <span class='hs-varid'>pred</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>darrow</span>
<a name="line-48"></a><span class='hs-definition'>pprThetaArrowTy</span> <span class='hs-varid'>preds</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>fsep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_type</span> <span class='hs-conid'>TopPrec</span><span class='hs-layout'>)</span> <span class='hs-varid'>preds</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-49"></a>                            <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>darrow</span>
<a name="line-50"></a>    <span class='hs-comment'>-- Notice 'fsep' here rather that 'sep', so that</span>
<a name="line-51"></a>    <span class='hs-comment'>-- type contexts don't get displayed in a giant column</span>
<a name="line-52"></a>    <span class='hs-comment'>-- Rather than</span>
<a name="line-53"></a>    <span class='hs-comment'>--  instance (Eq a,</span>
<a name="line-54"></a>    <span class='hs-comment'>--            Eq b,</span>
<a name="line-55"></a>    <span class='hs-comment'>--            Eq c,</span>
<a name="line-56"></a>    <span class='hs-comment'>--            Eq d,</span>
<a name="line-57"></a>    <span class='hs-comment'>--            Eq e,</span>
<a name="line-58"></a>    <span class='hs-comment'>--            Eq f,</span>
<a name="line-59"></a>    <span class='hs-comment'>--            Eq g,</span>
<a name="line-60"></a>    <span class='hs-comment'>--            Eq h,</span>
<a name="line-61"></a>    <span class='hs-comment'>--            Eq i,</span>
<a name="line-62"></a>    <span class='hs-comment'>--            Eq j,</span>
<a name="line-63"></a>    <span class='hs-comment'>--            Eq k,</span>
<a name="line-64"></a>    <span class='hs-comment'>--            Eq l) =&gt;</span>
<a name="line-65"></a>    <span class='hs-comment'>--           Eq (a, b, c, d, e, f, g, h, i, j, k, l)</span>
<a name="line-66"></a>    <span class='hs-comment'>-- we get</span>
<a name="line-67"></a>    <span class='hs-comment'>--</span>
<a name="line-68"></a>    <span class='hs-comment'>--  instance (Eq a, Eq b, Eq c, Eq d, Eq e, Eq f, Eq g, Eq h, Eq i,</span>
<a name="line-69"></a>    <span class='hs-comment'>--            Eq j, Eq k, Eq l) =&gt;</span>
<a name="line-70"></a>    <span class='hs-comment'>--           Eq (a, b, c, d, e, f, g, h, i, j, k, l)</span>
<a name="line-71"></a>
<a name="line-72"></a><span class='hs-comment'>------------------</span>
<a name="line-73"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-conid'>Type</span> <span class='hs-keyword'>where</span>
<a name="line-74"></a>    <span class='hs-varid'>ppr</span> <span class='hs-varid'>ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprType</span> <span class='hs-varid'>ty</span>
<a name="line-75"></a>
<a name="line-76"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Outputable</span> <span class='hs-varid'>name</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>OutputableBndr</span> <span class='hs-layout'>(</span><span class='hs-conid'>IPName</span> <span class='hs-varid'>name</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-77"></a>    <span class='hs-varid'>pprBndr</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>n</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span>	<span class='hs-comment'>-- Simple for now</span>
<a name="line-78"></a>    <span class='hs-varid'>pprInfixOcc</span>  <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span> 
<a name="line-79"></a>    <span class='hs-varid'>pprPrefixOcc</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span> 
<a name="line-80"></a>
<a name="line-81"></a><span class='hs-comment'>------------------</span>
<a name="line-82"></a>	<span class='hs-comment'>-- OK, here's the main printer</span>
<a name="line-83"></a>
<a name="line-84"></a><a name="ppr_type"></a><span class='hs-definition'>ppr_type</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-85"></a><span class='hs-definition'>ppr_type</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyVarTy</span> <span class='hs-varid'>tv</span><span class='hs-layout'>)</span>	      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_tvar</span> <span class='hs-varid'>tv</span>
<a name="line-86"></a><span class='hs-definition'>ppr_type</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>TyConApp</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTcApp</span> <span class='hs-varid'>p</span> <span class='hs-varid'>ppr_type</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>tys</span>
<a name="line-87"></a>
<a name="line-88"></a><span class='hs-definition'>ppr_type</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-conid'>AppTy</span> <span class='hs-varid'>t1</span> <span class='hs-varid'>t2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>p</span> <span class='hs-conid'>TyConPrec</span> <span class='hs-varop'>$</span>
<a name="line-89"></a>			   <span class='hs-varid'>pprType</span> <span class='hs-varid'>t1</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>ppr_type</span> <span class='hs-conid'>TyConPrec</span> <span class='hs-varid'>t2</span>
<a name="line-90"></a>
<a name="line-91"></a><span class='hs-definition'>ppr_type</span> <span class='hs-varid'>p</span> <span class='hs-varid'>ty</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>ForAllTy</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_forall_type</span> <span class='hs-varid'>p</span> <span class='hs-varid'>ty</span>
<a name="line-92"></a><span class='hs-definition'>ppr_type</span> <span class='hs-varid'>p</span> <span class='hs-varid'>fun_ty</span><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>FunTy</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span><span class='hs-layout'>)</span>
<a name="line-93"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isPredTy</span> <span class='hs-varid'>ty1</span>
<a name="line-94"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_forall_type</span> <span class='hs-varid'>p</span> <span class='hs-varid'>fun_ty</span>
<a name="line-95"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-96"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprArrowChain</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_type</span> <span class='hs-conid'>FunPrec</span> <span class='hs-varid'>ty1</span> <span class='hs-conop'>:</span> <span class='hs-varid'>ppr_fun_tail</span> <span class='hs-varid'>ty2</span><span class='hs-layout'>)</span>
<a name="line-97"></a>  <span class='hs-keyword'>where</span>
<a name="line-98"></a>    <span class='hs-comment'>-- We don't want to lose synonyms, so we mustn't use splitFunTys here.</span>
<a name="line-99"></a>    <span class='hs-varid'>ppr_fun_tail</span> <span class='hs-layout'>(</span><span class='hs-conid'>FunTy</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span><span class='hs-layout'>)</span>
<a name="line-100"></a>      <span class='hs-keyglyph'>|</span> <span class='hs-varid'>not</span> <span class='hs-layout'>(</span><span class='hs-varid'>isPredTy</span> <span class='hs-varid'>ty1</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_type</span> <span class='hs-conid'>FunPrec</span> <span class='hs-varid'>ty1</span> <span class='hs-conop'>:</span> <span class='hs-varid'>ppr_fun_tail</span> <span class='hs-varid'>ty2</span>
<a name="line-101"></a>    <span class='hs-varid'>ppr_fun_tail</span> <span class='hs-varid'>other_ty</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ppr_type</span> <span class='hs-conid'>TopPrec</span> <span class='hs-varid'>other_ty</span><span class='hs-keyglyph'>]</span>
<a name="line-102"></a>
<a name="line-103"></a><a name="ppr_forall_type"></a><span class='hs-definition'>ppr_forall_type</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Type</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-104"></a><span class='hs-definition'>ppr_forall_type</span> <span class='hs-varid'>p</span> <span class='hs-varid'>ty</span>
<a name="line-105"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>p</span> <span class='hs-conid'>FunPrec</span> <span class='hs-varop'>$</span>
<a name="line-106"></a>    <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pprForAll</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprThetaArrowTy</span> <span class='hs-varid'>ctxt</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprType</span> <span class='hs-varid'>tau</span><span class='hs-keyglyph'>]</span>
<a name="line-107"></a>  <span class='hs-keyword'>where</span>
<a name="line-108"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>tvs</span><span class='hs-layout'>,</span>  <span class='hs-varid'>rho</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>split1</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>ty</span>
<a name="line-109"></a>    <span class='hs-layout'>(</span><span class='hs-varid'>ctxt</span><span class='hs-layout'>,</span> <span class='hs-varid'>tau</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>split2</span> <span class='hs-conid'>[]</span> <span class='hs-varid'>rho</span>
<a name="line-110"></a>
<a name="line-111"></a>    <span class='hs-varid'>split1</span> <span class='hs-varid'>tvs</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForAllTy</span> <span class='hs-varid'>tv</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>split1</span> <span class='hs-layout'>(</span><span class='hs-varid'>tv</span><span class='hs-conop'>:</span><span class='hs-varid'>tvs</span><span class='hs-layout'>)</span> <span class='hs-varid'>ty</span>
<a name="line-112"></a>    <span class='hs-varid'>split1</span> <span class='hs-varid'>tvs</span> <span class='hs-varid'>ty</span>          <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>reverse</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>,</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-113"></a> 
<a name="line-114"></a>    <span class='hs-varid'>split2</span> <span class='hs-varid'>ps</span> <span class='hs-layout'>(</span><span class='hs-varid'>ty1</span> <span class='hs-varop'>`FunTy`</span> <span class='hs-varid'>ty2</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isPredTy</span> <span class='hs-varid'>ty1</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>split2</span> <span class='hs-layout'>(</span><span class='hs-varid'>ty1</span><span class='hs-conop'>:</span><span class='hs-varid'>ps</span><span class='hs-layout'>)</span> <span class='hs-varid'>ty2</span>
<a name="line-115"></a>    <span class='hs-varid'>split2</span> <span class='hs-varid'>ps</span> <span class='hs-varid'>ty</span>                               <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>reverse</span> <span class='hs-varid'>ps</span><span class='hs-layout'>,</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-116"></a>
<a name="line-117"></a><a name="ppr_tvar"></a><span class='hs-definition'>ppr_tvar</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyVar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-118"></a><span class='hs-definition'>ppr_tvar</span> <span class='hs-varid'>tv</span>  <span class='hs-comment'>-- Note [Infix type variables]</span>
<a name="line-119"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parenSymOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>getOccName</span> <span class='hs-varid'>tv</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tv</span><span class='hs-layout'>)</span>
<a name="line-120"></a>
<a name="line-121"></a><a name="pprForAll"></a><span class='hs-comment'>-------------------</span>
<a name="line-122"></a><span class='hs-definition'>pprForAll</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>TyVar</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-123"></a><span class='hs-definition'>pprForAll</span> <span class='hs-conid'>[]</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-124"></a><span class='hs-definition'>pprForAll</span> <span class='hs-varid'>tvs</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"forall"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>pprTvBndr</span> <span class='hs-varid'>tvs</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>dot</span>
<a name="line-125"></a>
<a name="line-126"></a><a name="pprTvBndr"></a><span class='hs-definition'>pprTvBndr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>TyVar</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-127"></a><span class='hs-definition'>pprTvBndr</span> <span class='hs-varid'>tv</span> 
<a name="line-128"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isLiftedTypeKind</span> <span class='hs-varid'>kind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr_tvar</span> <span class='hs-varid'>tv</span>
<a name="line-129"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>	          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>parens</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr_tvar</span> <span class='hs-varid'>tv</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>dcolon</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pprKind</span> <span class='hs-varid'>kind</span><span class='hs-layout'>)</span>
<a name="line-130"></a>	     <span class='hs-keyword'>where</span>
<a name="line-131"></a>	       <span class='hs-varid'>kind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tyVarKind</span> <span class='hs-varid'>tv</span>
</pre>\end{code}

Note [Infix type variables]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
With TypeOperators you can say

   f :: (a ~> b) -> b

and the (~>) is considered a type variable.  However, the type
pretty-printer in this module will just see (a ~> b) as

   App (App (TyVarTy "~>") (TyVarTy "a")) (TyVarTy "b")

So it'll print the type in prefix form.  To avoid confusion we must
remember to parenthesise the operator, thus

   (~>) a b -> b

See Trac #2766.

\begin{code}
<pre><a name="line-1"></a><a name="pprTcApp"></a><span class='hs-definition'>pprTcApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>TyCon</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-2"></a><span class='hs-definition'>pprTcApp</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>tc</span> <span class='hs-conid'>[]</span>      <span class='hs-comment'>-- No brackets for SymOcc</span>
<a name="line-3"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pp_nt_debug</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>tc</span>
<a name="line-4"></a>  <span class='hs-keyword'>where</span>
<a name="line-5"></a>   <span class='hs-varid'>pp_nt_debug</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isNewTyCon</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ifPprDebug</span> <span class='hs-layout'>(</span><span class='hs-keyword'>if</span> <span class='hs-varid'>isRecursiveTyCon</span> <span class='hs-varid'>tc</span> 
<a name="line-6"></a>				             <span class='hs-keyword'>then</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"&lt;recnt&gt;"</span><span class='hs-layout'>)</span>
<a name="line-7"></a>					     <span class='hs-keyword'>else</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"&lt;nt&gt;"</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-8"></a>	       <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-9"></a>
<a name="line-10"></a><span class='hs-definition'>pprTcApp</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>pp</span> <span class='hs-varid'>tc</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ty</span><span class='hs-keyglyph'>]</span>
<a name="line-11"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>listTyConKey</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>brackets</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp</span> <span class='hs-conid'>TopPrec</span> <span class='hs-varid'>ty</span><span class='hs-layout'>)</span>
<a name="line-12"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>parrTyConKey</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"[:"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pp</span> <span class='hs-conid'>TopPrec</span> <span class='hs-varid'>ty</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>":]"</span><span class='hs-layout'>)</span>
<a name="line-13"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>liftedTypeKindTyConKey</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"*"</span><span class='hs-layout'>)</span>
<a name="line-14"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>unliftedTypeKindTyConKey</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"#"</span><span class='hs-layout'>)</span>
<a name="line-15"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>openTypeKindTyConKey</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"OpenKind"</span><span class='hs-layout'>)</span>
<a name="line-16"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>ubxTupleKindTyConKey</span>     <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"(#)"</span><span class='hs-layout'>)</span>
<a name="line-17"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>argTypeKindTyConKey</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"ArgKind"</span><span class='hs-layout'>)</span>
<a name="line-18"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tyConIP_maybe</span> <span class='hs-varid'>tc</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ppr</span> <span class='hs-varid'>n</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>ptext</span> <span class='hs-layout'>(</span><span class='hs-varid'>sLit</span> <span class='hs-str'>"::"</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;&gt;</span> <span class='hs-varid'>pp</span> <span class='hs-conid'>TopPrec</span> <span class='hs-varid'>ty</span>
<a name="line-19"></a>
<a name="line-20"></a><span class='hs-definition'>pprTcApp</span> <span class='hs-varid'>p</span> <span class='hs-varid'>pp</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>tys</span>
<a name="line-21"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>isTupleTyCon</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>tyConArity</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>==</span> <span class='hs-varid'>length</span> <span class='hs-varid'>tys</span>
<a name="line-22"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>tupleParens</span> <span class='hs-layout'>(</span><span class='hs-varid'>tupleTyConSort</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>punctuate</span> <span class='hs-varid'>comma</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp</span> <span class='hs-conid'>TopPrec</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-23"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>tc</span> <span class='hs-varop'>`hasKey`</span> <span class='hs-varid'>eqTyConKey</span> <span class='hs-comment'>-- We need to special case the type equality TyCon because</span>
<a name="line-24"></a>                           <span class='hs-comment'>-- its not a SymOcc so won't get printed infix</span>
<a name="line-25"></a>  <span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>ty1</span><span class='hs-layout'>,</span><span class='hs-varid'>ty2</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tys</span>
<a name="line-26"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprInfixApp</span> <span class='hs-varid'>p</span> <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-varid'>getName</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span>
<a name="line-27"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-28"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTypeNameApp</span> <span class='hs-varid'>p</span> <span class='hs-varid'>pp</span> <span class='hs-layout'>(</span><span class='hs-varid'>getName</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span>
<a name="line-29"></a>
<a name="line-30"></a><a name="pprTypeApp"></a><span class='hs-comment'>----------------</span>
<a name="line-31"></a><span class='hs-definition'>pprTypeApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>NamedThing</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Type</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-32"></a><span class='hs-comment'>-- The first arg is the tycon, or sometimes class</span>
<a name="line-33"></a><span class='hs-comment'>-- Print infix if the tycon/class looks like an operator</span>
<a name="line-34"></a><span class='hs-definition'>pprTypeApp</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprTypeNameApp</span> <span class='hs-conid'>TopPrec</span> <span class='hs-varid'>ppr_type</span> <span class='hs-layout'>(</span><span class='hs-varid'>getName</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span>
<a name="line-35"></a>
<a name="line-36"></a><a name="pprTypeNameApp"></a><span class='hs-definition'>pprTypeNameApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>a</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-37"></a><span class='hs-comment'>-- Used for classes and coercions as well as types; that's why it's separate from pprTcApp</span>
<a name="line-38"></a><span class='hs-definition'>pprTypeNameApp</span> <span class='hs-varid'>p</span> <span class='hs-varid'>pp</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>tys</span>
<a name="line-39"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>is_sym_occ</span>           <span class='hs-comment'>-- Print infix if possible</span>
<a name="line-40"></a>  <span class='hs-layout'>,</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>ty1</span><span class='hs-layout'>,</span><span class='hs-varid'>ty2</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>tys</span>  <span class='hs-comment'>-- We know nothing of precedence though</span>
<a name="line-41"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprInfixApp</span> <span class='hs-varid'>p</span> <span class='hs-varid'>pp</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span>
<a name="line-42"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span>
<a name="line-43"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pprPrefixApp</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>pprPrefixVar</span> <span class='hs-varid'>is_sym_occ</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>pp</span> <span class='hs-conid'>TyConPrec</span><span class='hs-layout'>)</span> <span class='hs-varid'>tys</span><span class='hs-layout'>)</span>
<a name="line-44"></a>  <span class='hs-keyword'>where</span>
<a name="line-45"></a>    <span class='hs-varid'>is_sym_occ</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isSymOcc</span> <span class='hs-layout'>(</span><span class='hs-varid'>getOccName</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span>
<a name="line-46"></a>
<a name="line-47"></a><a name="pprInfixApp"></a><span class='hs-comment'>----------------</span>
<a name="line-48"></a><span class='hs-definition'>pprInfixApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-49"></a><span class='hs-definition'>pprInfixApp</span> <span class='hs-varid'>p</span> <span class='hs-varid'>pp</span> <span class='hs-varid'>tc</span> <span class='hs-varid'>ty1</span> <span class='hs-varid'>ty2</span>
<a name="line-50"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>p</span> <span class='hs-conid'>FunPrec</span> <span class='hs-varop'>$</span>
<a name="line-51"></a>    <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>pp</span> <span class='hs-conid'>FunPrec</span> <span class='hs-varid'>ty1</span><span class='hs-layout'>,</span> <span class='hs-varid'>pprInfixVar</span> <span class='hs-conid'>True</span> <span class='hs-layout'>(</span><span class='hs-varid'>ppr</span> <span class='hs-varid'>tc</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;+&gt;</span> <span class='hs-varid'>pp</span> <span class='hs-conid'>FunPrec</span> <span class='hs-varid'>ty2</span><span class='hs-keyglyph'>]</span>
<a name="line-52"></a>
<a name="line-53"></a><a name="pprPrefixApp"></a><span class='hs-definition'>pprPrefixApp</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SDoc</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-54"></a><span class='hs-definition'>pprPrefixApp</span> <span class='hs-varid'>p</span> <span class='hs-varid'>pp_fun</span> <span class='hs-varid'>pp_tys</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>p</span> <span class='hs-conid'>TyConPrec</span> <span class='hs-varop'>$</span>
<a name="line-55"></a>                               <span class='hs-varid'>hang</span> <span class='hs-varid'>pp_fun</span> <span class='hs-num'>2</span> <span class='hs-layout'>(</span><span class='hs-varid'>sep</span> <span class='hs-varid'>pp_tys</span><span class='hs-layout'>)</span>
<a name="line-56"></a>
<a name="line-57"></a><a name="pprArrowChain"></a><span class='hs-comment'>----------------</span>
<a name="line-58"></a><span class='hs-definition'>pprArrowChain</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Prec</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>SDoc</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>SDoc</span>
<a name="line-59"></a><span class='hs-comment'>-- pprArrowChain p [a,b,c]  generates   a -&gt; b -&gt; c</span>
<a name="line-60"></a><span class='hs-definition'>pprArrowChain</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>[]</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>empty</span>
<a name="line-61"></a><span class='hs-definition'>pprArrowChain</span> <span class='hs-varid'>p</span> <span class='hs-layout'>(</span><span class='hs-varid'>arg</span><span class='hs-conop'>:</span><span class='hs-varid'>args</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybeParen</span> <span class='hs-varid'>p</span> <span class='hs-conid'>FunPrec</span> <span class='hs-varop'>$</span>
<a name="line-62"></a>                             <span class='hs-varid'>sep</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>arg</span><span class='hs-layout'>,</span> <span class='hs-varid'>sep</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>arrow</span> <span class='hs-varop'>&lt;+&gt;</span><span class='hs-layout'>)</span> <span class='hs-varid'>args</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
</pre>\end{code}

</body>
</html>
