<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>cmm/OldCmm.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-2"></a><span class='hs-comment'>--</span>
<a name="line-3"></a><span class='hs-comment'>-- Old-style Cmm data types</span>
<a name="line-4"></a><span class='hs-comment'>--</span>
<a name="line-5"></a><span class='hs-comment'>-- (c) The University of Glasgow 2004-2006</span>
<a name="line-6"></a><span class='hs-comment'>--</span>
<a name="line-7"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-8"></a>
<a name="line-9"></a><span class='hs-comment'>{-# OPTIONS -fno-warn-tabs #-}</span>
<a name="line-10"></a><span class='hs-comment'>-- The above warning supression flag is a temporary kludge.</span>
<a name="line-11"></a><span class='hs-comment'>-- While working on this module you are encouraged to remove it and</span>
<a name="line-12"></a><span class='hs-comment'>-- detab the module (please do the detabbing in a separate patch). See</span>
<a name="line-13"></a><span class='hs-comment'>--     <a href="http://hackage.haskell.org/trac/ghc/wiki/Commentary/CodingStyle#TabsvsSpaces">http://hackage.haskell.org/trac/ghc/wiki/Commentary/CodingStyle#TabsvsSpaces</a></span>
<a name="line-14"></a><span class='hs-comment'>-- for details</span>
<a name="line-15"></a>
<a name="line-16"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>OldCmm</span> <span class='hs-layout'>(</span>
<a name="line-17"></a>        <span class='hs-conid'>CmmGroup</span><span class='hs-layout'>,</span> <span class='hs-conid'>GenCmmGroup</span><span class='hs-layout'>,</span> <span class='hs-conid'>RawCmmGroup</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmDecl</span><span class='hs-layout'>,</span> <span class='hs-conid'>RawCmmDecl</span><span class='hs-layout'>,</span>
<a name="line-18"></a>        <span class='hs-conid'>ListGraph</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-19"></a>        <span class='hs-conid'>CmmInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>UpdateFrame</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmInfoTable</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>ClosureTypeInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-20"></a>        <span class='hs-conid'>CmmStatic</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmStatics</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmFormal</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmActual</span><span class='hs-layout'>,</span>
<a name="line-21"></a>        <span class='hs-varid'>cmmMapGraph</span><span class='hs-layout'>,</span> <span class='hs-varid'>cmmTopMapGraph</span><span class='hs-layout'>,</span>
<a name="line-22"></a>        <span class='hs-conid'>GenBasicBlock</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmBasicBlock</span><span class='hs-layout'>,</span> <span class='hs-varid'>blockId</span><span class='hs-layout'>,</span> <span class='hs-varid'>blockStmts</span><span class='hs-layout'>,</span> <span class='hs-varid'>mapBlockStmts</span><span class='hs-layout'>,</span>
<a name="line-23"></a>        <span class='hs-conid'>CmmStmt</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmReturnInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmHinted</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-24"></a>        <span class='hs-conid'>HintedCmmFormal</span><span class='hs-layout'>,</span> <span class='hs-conid'>HintedCmmActual</span><span class='hs-layout'>,</span>
<a name="line-25"></a>        <span class='hs-conid'>CmmSafety</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmCallTarget</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-26"></a>        <span class='hs-conid'>New</span><span class='hs-varop'>.</span><span class='hs-conid'>GenCmmDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-27"></a>        <span class='hs-conid'>New</span><span class='hs-varop'>.</span><span class='hs-conid'>ForeignHint</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-28"></a>        <span class='hs-keyword'>module</span> <span class='hs-conid'>CmmExpr</span><span class='hs-layout'>,</span>
<a name="line-29"></a>        <span class='hs-conid'>Section</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-30"></a>        <span class='hs-conid'>ProfilingInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>C_SRT</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-31"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-32"></a>
<a name="line-33"></a><span class='hs-cpp'>#include "HsVersions.h"</span>
<a name="line-34"></a>
<a name="line-35"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Cmm</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>New</span>
<a name="line-36"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>Cmm</span>           <span class='hs-layout'>(</span> <span class='hs-conid'>CmmInfoTable</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>GenCmmGroup</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmStatics</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>GenCmmDecl</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-37"></a>                       <span class='hs-conid'>CmmFormal</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmActual</span><span class='hs-layout'>,</span> <span class='hs-conid'>Section</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>CmmStatic</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span>
<a name="line-38"></a>                       <span class='hs-conid'>ProfilingInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-conid'>ClosureTypeInfo</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span> <span class='hs-layout'>)</span>
<a name="line-39"></a>
<a name="line-40"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>BlockId</span>
<a name="line-41"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>CmmExpr</span>
<a name="line-42"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>ForeignCall</span>
<a name="line-43"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>ClosureInfo</span>
<a name="line-44"></a><span class='hs-keyword'>import</span> <span class='hs-conid'>FastString</span>
<a name="line-45"></a>
<a name="line-46"></a>
<a name="line-47"></a><span class='hs-comment'>-- A [[BlockId]] is a local label.</span>
<a name="line-48"></a><span class='hs-comment'>-- Local labels must be unique within an entire compilation unit, not</span>
<a name="line-49"></a><span class='hs-comment'>-- just a single top-level item, because local labels map one-to-one</span>
<a name="line-50"></a><span class='hs-comment'>-- with assembly-language labels.</span>
<a name="line-51"></a>
<a name="line-52"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-53"></a><span class='hs-comment'>--     Info Tables</span>
<a name="line-54"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-55"></a>
<a name="line-56"></a><a name="CmmInfo"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>CmmInfo</span>
<a name="line-57"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmInfo</span>
<a name="line-58"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>BlockId</span><span class='hs-layout'>)</span>     <span class='hs-comment'>-- GC target. Nothing &lt;=&gt; CPS won't do stack check</span>
<a name="line-59"></a>                          <span class='hs-comment'>-- JD: NOT USED BY NEW CODE GEN</span>
<a name="line-60"></a>      <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>UpdateFrame</span><span class='hs-layout'>)</span> <span class='hs-comment'>-- Update frame</span>
<a name="line-61"></a>      <span class='hs-conid'>CmmInfoTable</span>        <span class='hs-comment'>-- Info table</span>
<a name="line-62"></a>
<a name="line-63"></a><a name="UpdateFrame"></a><span class='hs-comment'>-- | A frame that is to be pushed before entry to the function.</span>
<a name="line-64"></a><a name="UpdateFrame"></a><span class='hs-comment'>-- Used to handle 'update' frames.</span>
<a name="line-65"></a><a name="UpdateFrame"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>UpdateFrame</span> <span class='hs-keyglyph'>=</span>
<a name="line-66"></a>    <span class='hs-conid'>UpdateFrame</span>
<a name="line-67"></a>      <span class='hs-conid'>CmmExpr</span>    <span class='hs-comment'>-- Frame header.  Behaves like the target of a 'jump'.</span>
<a name="line-68"></a>      <span class='hs-keyglyph'>[</span><span class='hs-conid'>CmmExpr</span><span class='hs-keyglyph'>]</span>  <span class='hs-comment'>-- Frame remainder.  Behaves like the arguments of a 'jump'.</span>
<a name="line-69"></a>
<a name="line-70"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-71"></a><span class='hs-comment'>--  Cmm, CmmDecl, CmmBasicBlock</span>
<a name="line-72"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-73"></a>
<a name="line-74"></a><span class='hs-comment'>-- A file is a list of top-level chunks.  These may be arbitrarily</span>
<a name="line-75"></a><span class='hs-comment'>-- re-orderd during code generation.</span>
<a name="line-76"></a>
<a name="line-77"></a><a name="ListGraph"></a><span class='hs-comment'>-- | A control-flow graph represented as a list of extended basic blocks.</span>
<a name="line-78"></a><a name="ListGraph"></a><span class='hs-keyword'>newtype</span> <span class='hs-conid'>ListGraph</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ListGraph</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>GenBasicBlock</span> <span class='hs-varid'>i</span><span class='hs-keyglyph'>]</span>
<a name="line-79"></a>   <span class='hs-comment'>-- ^ Code, may be empty.  The first block is the entry point.  The</span>
<a name="line-80"></a>   <span class='hs-comment'>-- order is otherwise initially unimportant, but at some point the</span>
<a name="line-81"></a>   <span class='hs-comment'>-- code gen will fix the order.</span>
<a name="line-82"></a>
<a name="line-83"></a>   <span class='hs-comment'>-- BlockIds must be unique across an entire compilation unit, since</span>
<a name="line-84"></a>   <span class='hs-comment'>-- they are translated to assembly-language labels, which scope</span>
<a name="line-85"></a>   <span class='hs-comment'>-- across a whole compilation unit.</span>
<a name="line-86"></a>
<a name="line-87"></a><a name="CmmGroup"></a><span class='hs-comment'>-- | Cmm with the info table as a data type</span>
<a name="line-88"></a><a name="CmmGroup"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>CmmGroup</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GenCmmGroup</span> <span class='hs-conid'>CmmStatics</span> <span class='hs-conid'>CmmInfo</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListGraph</span> <span class='hs-conid'>CmmStmt</span><span class='hs-layout'>)</span>
<a name="line-89"></a><a name="CmmDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>CmmDecl</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GenCmmDecl</span> <span class='hs-conid'>CmmStatics</span> <span class='hs-conid'>CmmInfo</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListGraph</span> <span class='hs-conid'>CmmStmt</span><span class='hs-layout'>)</span>
<a name="line-90"></a>
<a name="line-91"></a><a name="RawCmmGroup"></a><span class='hs-comment'>-- | Cmm with the info tables converted to a list of 'CmmStatic' along with the info</span>
<a name="line-92"></a><a name="RawCmmGroup"></a><span class='hs-comment'>-- table label. If we are building without tables-next-to-code there will be no statics</span>
<a name="line-93"></a><a name="RawCmmGroup"></a><span class='hs-comment'>--</span>
<a name="line-94"></a><a name="RawCmmGroup"></a><span class='hs-comment'>-- INVARIANT: if there is an info table, it has at least one CmmStatic</span>
<a name="line-95"></a><a name="RawCmmGroup"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>RawCmmGroup</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GenCmmGroup</span> <span class='hs-conid'>CmmStatics</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>CmmStatics</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListGraph</span> <span class='hs-conid'>CmmStmt</span><span class='hs-layout'>)</span>
<a name="line-96"></a><a name="RawCmmDecl"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>RawCmmDecl</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GenCmmDecl</span> <span class='hs-conid'>CmmStatics</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>CmmStatics</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListGraph</span> <span class='hs-conid'>CmmStmt</span><span class='hs-layout'>)</span>
<a name="line-97"></a>
<a name="line-98"></a>
<a name="line-99"></a><span class='hs-comment'>-- A basic block containing a single label, at the beginning.</span>
<a name="line-100"></a><span class='hs-comment'>-- The list of basic blocks in a top-level code block may be re-ordered.</span>
<a name="line-101"></a><span class='hs-comment'>-- Fall-through is not allowed: there must be an explicit jump at the</span>
<a name="line-102"></a><span class='hs-comment'>-- end of each basic block, but the code generator might rearrange basic</span>
<a name="line-103"></a><span class='hs-comment'>-- blocks in order to turn some jumps into fallthroughs.</span>
<a name="line-104"></a>
<a name="line-105"></a><a name="GenBasicBlock"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>GenBasicBlock</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BasicBlock</span> <span class='hs-conid'>BlockId</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>i</span><span class='hs-keyglyph'>]</span>
<a name="line-106"></a><a name="CmmBasicBlock"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>CmmBasicBlock</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>GenBasicBlock</span> <span class='hs-conid'>CmmStmt</span>
<a name="line-107"></a>
<a name="line-108"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>UserOfLocalRegs</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>UserOfLocalRegs</span> <span class='hs-layout'>(</span><span class='hs-conid'>GenBasicBlock</span> <span class='hs-varid'>i</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-109"></a>    <span class='hs-varid'>foldRegsUsed</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-layout'>(</span><span class='hs-conid'>BasicBlock</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldRegsUsed</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-varid'>l</span>
<a name="line-110"></a>
<a name="line-111"></a><a name="blockId"></a><span class='hs-definition'>blockId</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>GenBasicBlock</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>BlockId</span>
<a name="line-112"></a><span class='hs-comment'>-- The branch block id is that of the first block in </span>
<a name="line-113"></a><span class='hs-comment'>-- the branch, which is that branch's entry point</span>
<a name="line-114"></a><span class='hs-definition'>blockId</span> <span class='hs-layout'>(</span><span class='hs-conid'>BasicBlock</span> <span class='hs-varid'>blk_id</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>blk_id</span>
<a name="line-115"></a>
<a name="line-116"></a><a name="blockStmts"></a><span class='hs-definition'>blockStmts</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>GenBasicBlock</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>i</span><span class='hs-keyglyph'>]</span>
<a name="line-117"></a><span class='hs-definition'>blockStmts</span> <span class='hs-layout'>(</span><span class='hs-conid'>BasicBlock</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>stmts</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stmts</span>
<a name="line-118"></a>
<a name="line-119"></a>
<a name="line-120"></a><a name="mapBlockStmts"></a><span class='hs-definition'>mapBlockStmts</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>i'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenBasicBlock</span> <span class='hs-varid'>i</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenBasicBlock</span> <span class='hs-varid'>i'</span>
<a name="line-121"></a><span class='hs-definition'>mapBlockStmts</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>BasicBlock</span> <span class='hs-varid'>id</span> <span class='hs-varid'>bs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>BasicBlock</span> <span class='hs-varid'>id</span> <span class='hs-layout'>(</span><span class='hs-varid'>map</span> <span class='hs-varid'>f</span> <span class='hs-varid'>bs</span><span class='hs-layout'>)</span>
<a name="line-122"></a><span class='hs-comment'>----------------------------------------------------------------</span>
<a name="line-123"></a><span class='hs-comment'>--   graph maps</span>
<a name="line-124"></a><span class='hs-comment'>----------------------------------------------------------------</span>
<a name="line-125"></a>
<a name="line-126"></a><a name="cmmMapGraph"></a><span class='hs-definition'>cmmMapGraph</span>    <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>g'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenCmmGroup</span> <span class='hs-varid'>d</span> <span class='hs-varid'>h</span> <span class='hs-varid'>g</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenCmmGroup</span> <span class='hs-varid'>d</span> <span class='hs-varid'>h</span> <span class='hs-varid'>g'</span>
<a name="line-127"></a><a name="cmmTopMapGraph"></a><span class='hs-definition'>cmmTopMapGraph</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-varid'>g</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>g'</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenCmmDecl</span> <span class='hs-varid'>d</span> <span class='hs-varid'>h</span> <span class='hs-varid'>g</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>GenCmmDecl</span> <span class='hs-varid'>d</span> <span class='hs-varid'>h</span> <span class='hs-varid'>g'</span>
<a name="line-128"></a>
<a name="line-129"></a><span class='hs-definition'>cmmMapGraph</span> <span class='hs-varid'>f</span> <span class='hs-varid'>tops</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>cmmTopMapGraph</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span> <span class='hs-varid'>tops</span>
<a name="line-130"></a><span class='hs-definition'>cmmTopMapGraph</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmProc</span> <span class='hs-varid'>h</span> <span class='hs-varid'>l</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmProc</span> <span class='hs-varid'>h</span> <span class='hs-varid'>l</span> <span class='hs-layout'>(</span><span class='hs-varid'>f</span> <span class='hs-varid'>g</span><span class='hs-layout'>)</span>
<a name="line-131"></a><span class='hs-definition'>cmmTopMapGraph</span> <span class='hs-keyword'>_</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmData</span> <span class='hs-varid'>s</span> <span class='hs-varid'>ds</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmData</span> <span class='hs-varid'>s</span> <span class='hs-varid'>ds</span>
<a name="line-132"></a>
<a name="line-133"></a><a name="CmmReturnInfo"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>CmmReturnInfo</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmMayReturn</span>
<a name="line-134"></a>                   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmNeverReturns</span>
<a name="line-135"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span> <span class='hs-conid'>Eq</span> <span class='hs-layout'>)</span>
<a name="line-136"></a>
<a name="line-137"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-138"></a><span class='hs-comment'>--		CmmStmt</span>
<a name="line-139"></a><span class='hs-comment'>-- A "statement".  Note that all branches are explicit: there are no</span>
<a name="line-140"></a><span class='hs-comment'>-- control transfers to computed addresses, except when transfering</span>
<a name="line-141"></a><span class='hs-comment'>-- control to a new function.</span>
<a name="line-142"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-143"></a>
<a name="line-144"></a><a name="CmmStmt"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>CmmStmt</span>	<span class='hs-comment'>-- Old-style</span>
<a name="line-145"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmNop</span>
<a name="line-146"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmComment</span> <span class='hs-conid'>FastString</span>
<a name="line-147"></a>
<a name="line-148"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmAssign</span> <span class='hs-conid'>CmmReg</span> <span class='hs-conid'>CmmExpr</span>	 <span class='hs-comment'>-- Assign to register</span>
<a name="line-149"></a>
<a name="line-150"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmStore</span> <span class='hs-conid'>CmmExpr</span> <span class='hs-conid'>CmmExpr</span>     <span class='hs-comment'>-- Assign to memory location.  Size is</span>
<a name="line-151"></a>                                 <span class='hs-comment'>-- given by cmmExprType of the rhs.</span>
<a name="line-152"></a>
<a name="line-153"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmCall</span>	 		 <span class='hs-comment'>-- A call (foreign, native or primitive), with </span>
<a name="line-154"></a>     <span class='hs-conid'>CmmCallTarget</span>
<a name="line-155"></a>     <span class='hs-keyglyph'>[</span><span class='hs-conid'>HintedCmmFormal</span><span class='hs-keyglyph'>]</span>		 <span class='hs-comment'>-- zero or more results</span>
<a name="line-156"></a>     <span class='hs-keyglyph'>[</span><span class='hs-conid'>HintedCmmActual</span><span class='hs-keyglyph'>]</span>		 <span class='hs-comment'>-- zero or more arguments</span>
<a name="line-157"></a>     <span class='hs-conid'>CmmReturnInfo</span>
<a name="line-158"></a>  <span class='hs-comment'>-- Some care is necessary when handling the arguments of these, see</span>
<a name="line-159"></a>  <span class='hs-comment'>-- [Register parameter passing] and the hack in cmm/CmmOpt.hs</span>
<a name="line-160"></a>
<a name="line-161"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmBranch</span> <span class='hs-conid'>BlockId</span>             <span class='hs-comment'>-- branch to another BB in this fn</span>
<a name="line-162"></a>
<a name="line-163"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmCondBranch</span> <span class='hs-conid'>CmmExpr</span> <span class='hs-conid'>BlockId</span> <span class='hs-comment'>-- conditional branch</span>
<a name="line-164"></a>
<a name="line-165"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmSwitch</span> <span class='hs-conid'>CmmExpr</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>BlockId</span><span class='hs-keyglyph'>]</span>   <span class='hs-comment'>-- Table branch</span>
<a name="line-166"></a>	<span class='hs-comment'>-- The scrutinee is zero-based; </span>
<a name="line-167"></a>	<span class='hs-comment'>--	zero -&gt; first block</span>
<a name="line-168"></a>	<span class='hs-comment'>--	one  -&gt; second block etc</span>
<a name="line-169"></a>	<span class='hs-comment'>-- Undefined outside range, and when there's a Nothing</span>
<a name="line-170"></a>
<a name="line-171"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmJump</span> <span class='hs-conid'>CmmExpr</span>      <span class='hs-comment'>-- Jump to another C-- function,</span>
<a name="line-172"></a>      <span class='hs-keyglyph'>[</span><span class='hs-conid'>HintedCmmActual</span><span class='hs-keyglyph'>]</span>        <span class='hs-comment'>-- with these parameters.  (parameters never used)</span>
<a name="line-173"></a>
<a name="line-174"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmReturn</span>            <span class='hs-comment'>-- Return from a native C-- function,</span>
<a name="line-175"></a>      <span class='hs-keyglyph'>[</span><span class='hs-conid'>HintedCmmActual</span><span class='hs-keyglyph'>]</span>        <span class='hs-comment'>-- with these return values. (parameters never used)</span>
<a name="line-176"></a>
<a name="line-177"></a><a name="CmmHinted"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>CmmHinted</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmHinted</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hintlessCmm</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>cmmHint</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>New</span><span class='hs-varop'>.</span><span class='hs-conid'>ForeignHint</span> <span class='hs-layout'>}</span>
<a name="line-178"></a>	   	 <span class='hs-keyword'>deriving</span><span class='hs-layout'>(</span> <span class='hs-conid'>Eq</span> <span class='hs-layout'>)</span>
<a name="line-179"></a>
<a name="line-180"></a><a name="HintedCmmFormal"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HintedCmmFormal</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmHinted</span> <span class='hs-conid'>CmmFormal</span>
<a name="line-181"></a><a name="HintedCmmActual"></a><span class='hs-keyword'>type</span> <span class='hs-conid'>HintedCmmActual</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmHinted</span> <span class='hs-conid'>CmmActual</span>
<a name="line-182"></a>
<a name="line-183"></a><a name="CmmSafety"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>CmmSafety</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmUnsafe</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmSafe</span> <span class='hs-conid'>C_SRT</span> <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmInterruptible</span>
<a name="line-184"></a>
<a name="line-185"></a><span class='hs-comment'>-- | enable us to fold used registers over '[CmmActual]' and '[CmmFormal]'</span>
<a name="line-186"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>UserOfLocalRegs</span> <span class='hs-conid'>CmmStmt</span> <span class='hs-keyword'>where</span>
<a name="line-187"></a>  <span class='hs-varid'>foldRegsUsed</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-varid'>set</span><span class='hs-keyglyph'>::</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varid'>s</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>stmt</span> <span class='hs-varid'>s</span> <span class='hs-varid'>set</span>
<a name="line-188"></a>    <span class='hs-keyword'>where</span> 
<a name="line-189"></a>      <span class='hs-varid'>stmt</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>CmmStmt</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>
<a name="line-190"></a>      <span class='hs-varid'>stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmNop</span><span class='hs-layout'>)</span>                  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span>
<a name="line-191"></a>      <span class='hs-varid'>stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmComment</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span>
<a name="line-192"></a>      <span class='hs-varid'>stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmAssign</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>e</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gen</span> <span class='hs-varid'>e</span>
<a name="line-193"></a>      <span class='hs-varid'>stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmStore</span> <span class='hs-varid'>e1</span> <span class='hs-varid'>e2</span><span class='hs-layout'>)</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gen</span> <span class='hs-varid'>e1</span> <span class='hs-varop'>.</span> <span class='hs-varid'>gen</span> <span class='hs-varid'>e2</span>
<a name="line-194"></a>      <span class='hs-varid'>stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmCall</span> <span class='hs-varid'>target</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>es</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gen</span> <span class='hs-varid'>target</span> <span class='hs-varop'>.</span> <span class='hs-varid'>gen</span> <span class='hs-varid'>es</span>
<a name="line-195"></a>      <span class='hs-varid'>stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmBranch</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>             <span class='hs-keyglyph'>=</span> <span class='hs-varid'>id</span>
<a name="line-196"></a>      <span class='hs-varid'>stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmCondBranch</span> <span class='hs-varid'>e</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gen</span> <span class='hs-varid'>e</span>
<a name="line-197"></a>      <span class='hs-varid'>stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmSwitch</span> <span class='hs-varid'>e</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gen</span> <span class='hs-varid'>e</span>
<a name="line-198"></a>      <span class='hs-varid'>stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmJump</span> <span class='hs-varid'>e</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gen</span> <span class='hs-varid'>e</span> <span class='hs-varop'>.</span> <span class='hs-varid'>gen</span> <span class='hs-varid'>es</span>
<a name="line-199"></a>      <span class='hs-varid'>stmt</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmReturn</span> <span class='hs-varid'>es</span><span class='hs-layout'>)</span>            <span class='hs-keyglyph'>=</span> <span class='hs-varid'>gen</span> <span class='hs-varid'>es</span>
<a name="line-200"></a>
<a name="line-201"></a>      <span class='hs-varid'>gen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>UserOfLocalRegs</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span>
<a name="line-202"></a>      <span class='hs-varid'>gen</span> <span class='hs-varid'>a</span> <span class='hs-varid'>set</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldRegsUsed</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-varid'>a</span>
<a name="line-203"></a>
<a name="line-204"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>UserOfLocalRegs</span> <span class='hs-conid'>CmmCallTarget</span> <span class='hs-keyword'>where</span>
<a name="line-205"></a>    <span class='hs-varid'>foldRegsUsed</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmCallee</span> <span class='hs-varid'>e</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldRegsUsed</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-varid'>e</span>
<a name="line-206"></a>    <span class='hs-varid'>foldRegsUsed</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>set</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmPrim</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>set</span>
<a name="line-207"></a>
<a name="line-208"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>UserOfSlots</span> <span class='hs-conid'>CmmCallTarget</span> <span class='hs-keyword'>where</span>
<a name="line-209"></a>    <span class='hs-varid'>foldSlotsUsed</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmCallee</span> <span class='hs-varid'>e</span> <span class='hs-keyword'>_</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldSlotsUsed</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-varid'>e</span>
<a name="line-210"></a>    <span class='hs-varid'>foldSlotsUsed</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>set</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmPrim</span> <span class='hs-layout'>{</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>set</span>
<a name="line-211"></a>
<a name="line-212"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>UserOfLocalRegs</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>UserOfLocalRegs</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmHinted</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-213"></a>  <span class='hs-varid'>foldRegsUsed</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldRegsUsed</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-layout'>(</span><span class='hs-varid'>hintlessCmm</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-214"></a>
<a name="line-215"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>UserOfSlots</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>UserOfSlots</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmHinted</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-216"></a>  <span class='hs-varid'>foldSlotsUsed</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldSlotsUsed</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-layout'>(</span><span class='hs-varid'>hintlessCmm</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-217"></a>
<a name="line-218"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>DefinerOfLocalRegs</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>DefinerOfLocalRegs</span> <span class='hs-layout'>(</span><span class='hs-conid'>CmmHinted</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-219"></a>  <span class='hs-varid'>foldRegsDefd</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>foldRegsDefd</span> <span class='hs-varid'>f</span> <span class='hs-varid'>set</span> <span class='hs-layout'>(</span><span class='hs-varid'>hintlessCmm</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-220"></a>
<a name="line-221"></a><span class='hs-comment'>{-
<a name="line-222"></a>Discussion
<a name="line-223"></a>~~~~~~~~~~
<a name="line-224"></a>
<a name="line-225"></a>One possible problem with the above type is that the only way to do a
<a name="line-226"></a>non-local conditional jump is to encode it as a branch to a block that
<a name="line-227"></a>contains a single jump.  This leads to inefficient code in the back end.
<a name="line-228"></a>
<a name="line-229"></a>[N.B. This problem will go away when we make the transition to the
<a name="line-230"></a>'zipper' form of control-flow graph, in which both targets of a
<a name="line-231"></a>conditional jump are explicit. ---NR]
<a name="line-232"></a>
<a name="line-233"></a>One possible way to fix this would be:
<a name="line-234"></a>
<a name="line-235"></a>data CmmStat = 
<a name="line-236"></a>  ...
<a name="line-237"></a>  | CmmJump CmmBranchDest
<a name="line-238"></a>  | CmmCondJump CmmExpr CmmBranchDest
<a name="line-239"></a>  ...
<a name="line-240"></a>
<a name="line-241"></a>data CmmBranchDest
<a name="line-242"></a>  = Local BlockId
<a name="line-243"></a>  | NonLocal CmmExpr [LocalReg]
<a name="line-244"></a>
<a name="line-245"></a>In favour:
<a name="line-246"></a>
<a name="line-247"></a>+ one fewer constructors in CmmStmt
<a name="line-248"></a>+ allows both cond branch and switch to jump to non-local destinations
<a name="line-249"></a>
<a name="line-250"></a>Against:
<a name="line-251"></a>
<a name="line-252"></a>- not strictly necessary: can already encode as branch+jump
<a name="line-253"></a>- not always possible to implement any better in the back end
<a name="line-254"></a>- could do the optimisation in the back end (but then plat-specific?)
<a name="line-255"></a>- C-- doesn't have it
<a name="line-256"></a>- back-end optimisation might be more general (jump shortcutting)
<a name="line-257"></a>
<a name="line-258"></a>So we'll stick with the way it is, and add the optimisation to the NCG.
<a name="line-259"></a>-}</span>
<a name="line-260"></a>
<a name="line-261"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-262"></a><span class='hs-comment'>--		CmmCallTarget</span>
<a name="line-263"></a><span class='hs-comment'>--</span>
<a name="line-264"></a><span class='hs-comment'>-- The target of a CmmCall.</span>
<a name="line-265"></a><span class='hs-comment'>-----------------------------------------------------------------------------</span>
<a name="line-266"></a>
<a name="line-267"></a><a name="CmmCallTarget"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>CmmCallTarget</span>
<a name="line-268"></a>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>CmmCallee</span>		<span class='hs-comment'>-- Call a function (foreign or native)</span>
<a name="line-269"></a>	<span class='hs-conid'>CmmExpr</span> 		<span class='hs-comment'>-- literal label &lt;=&gt; static call</span>
<a name="line-270"></a>				<span class='hs-comment'>-- other expression &lt;=&gt; dynamic call</span>
<a name="line-271"></a>	<span class='hs-conid'>CCallConv</span>		<span class='hs-comment'>-- The calling convention</span>
<a name="line-272"></a>
<a name="line-273"></a>  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>CmmPrim</span>		<span class='hs-comment'>-- Call a "primitive" (eg. sin, cos)</span>
<a name="line-274"></a>	<span class='hs-conid'>CallishMachOp</span>		<span class='hs-comment'>-- These might be implemented as inline</span>
<a name="line-275"></a>				<span class='hs-comment'>-- code by the backend.</span>
<a name="line-276"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-conid'>Eq</span>
</pre></body>
</html>
